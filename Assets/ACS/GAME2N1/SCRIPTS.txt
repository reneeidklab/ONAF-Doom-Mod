#include "zcommon.acs"

int deaths = 0;

bool nightbegin = FALSE;
bool nightend = FALSE;

int hour = 0;
int minute = 0;

bool isLightsOn = TRUE;

int playersReady = 0;

int ready_players = 0;

script "WelcomeSong" (void)
{
	AmbientSound("WelcomeSong", 127);
}

script "SetPlayerTID" ENTER
{
    Thing_ChangeTID(0, 1000+PlayerNumber());
}

script "open" OPEN
{
	
}

script "CreateMonsters" (void)
{
	SpawnSpotFacingForced("BBB2", 201, 1);
	SetActorState(1, "Stage");
}

function void SetPlayerCharacter(int char)
{
    switch (char)
    {
        case 1:
			SetActorState(ActivatorTID(), "IsZoey", FALSE);
			GiveActorInventory(ActivatorTID(), "IsZoey", 1);
			ACS_NamedExecuteAlways("ClearSelectionMessages", 0, 0, 0, 0);
            break;
        case 2:
			SetActorState(ActivatorTID(), "IsLouis", FALSE);
			GiveActorInventory(ActivatorTID(), "IsLouis", 1);
			ACS_NamedExecuteAlways("ClearSelectionMessages", 0, 0, 0, 0);
            break;
        case 3:
			SetActorState(ActivatorTID(), "IsBill", FALSE);
			GiveActorInventory(ActivatorTID(), "IsBill", 1);
			ACS_NamedExecuteAlways("ClearSelectionMessages", 0, 0, 0, 0);
			break;
        case 4:
			SetActorState(ActivatorTID(), "IsFrancis", FALSE);
			GiveActorInventory(ActivatorTID(), "IsFrancis", 1);
			ACS_NamedExecuteAlways("ClearSelectionMessages", 0, 0, 0, 0);
            break;
        case 5:
			SetActorState(ActivatorTID(), "IsNick", FALSE);
			GiveActorInventory(ActivatorTID(), "IsNick", 1);
			ACS_NamedExecuteAlways("ClearSelectionMessages", 0, 0, 0, 0);
            break;
        case 6:
			SetActorState(ActivatorTID(), "IsEllis", FALSE);
			GiveActorInventory(ActivatorTID(), "IsEllis", 1);
			ACS_NamedExecuteAlways("ClearSelectionMessages", 0, 0, 0, 0);
            break;
    }
}

script 400 ENTER
{
    //Set Selection Title.
    SetFont("BIGFONT");
    HudMessage(s:"CHOOSE A CHARACTER:"; HUDMSG_PLAIN, 11, CR_RED, 0.5, 0.1, 0);
    HudMessage(s:"ZOEY"; HUDMSG_PLAIN, 5, CR_GOLD, 0.5, 0.25, 0);
    HudMessage(s:"LOUIS"; HUDMSG_PLAIN, 6, CR_GOLD, 0.5, 0.3, 0);
    HudMessage(s:"BILL"; HUDMSG_PLAIN, 7, CR_GOLD, 0.5, 0.35, 0);
    HudMessage(s:"FRANCIS"; HUDMSG_PLAIN, 8, CR_GOLD, 0.5, 0.4, 0);
    HudMessage(s:"NICK"; HUDMSG_PLAIN, 9, CR_GOLD, 0.5, 0.45, 0);
    HudMessage(s:"ELLIS"; HUDMSG_PLAIN, 10, CR_GOLD, 0.5, 0.5, 0);
}

script "ClearSelectionMessages" (void)
{
	HudMessage(s:""; HUDMSG_PLAIN, 5, CR_YELLOW, 0.5, 0.05, 0.0);
	HudMessage(s:""; HUDMSG_PLAIN, 6, CR_YELLOW, 0.5, 0.3, 0.0);
	HudMessage(s:""; HUDMSG_PLAIN, 7, CR_YELLOW, 0.5, 0.35, 0.0);
	HudMessage(s:""; HUDMSG_PLAIN, 8, CR_YELLOW, 0.5, 0.4, 0.0);
	HudMessage(s:""; HUDMSG_PLAIN, 9, CR_YELLOW, 0.5, 0.45, 0.0);
	HudMessage(s:""; HUDMSG_PLAIN, 10, CR_YELLOW, 0.5, 0.5, 0.0);
	HudMessage(s:""; HUDMSG_PLAIN, 11, CR_YELLOW, 0.5, 0.5, 0.0);
	HudMessage(s:""; HUDMSG_PLAIN, 111, CR_YELLOW, 0.5, 0.5, 0.0);
	Delay(1);
	Restart;
}

script 265 ENTER
{
	if (nightbegin == FALSE)
	{
		HudMessageBold(i:ready_players, s:" PLAYERS READY"; HUDMSG_PLAIN, 600, CR_CYAN, 0.5, 0.95, 0.0);
	}
	else if (nightbegin == TRUE)
	{
		HudMessageBold(s:""; HUDMSG_PLAIN, 600, CR_CYAN, 0.5, 0.95, 0.0);
	}

	Delay(1);
	Restart;
}

script 1 ENTER
{
	SetPlayerProperty(1, 1, PROP_TOTALLYFROZEN);
	ACS_NamedExecuteAlways("CharacterSelection",0,0,0,0);
}

script "CharacterSelection" (void)
{
	bool bAlreadySelected = FALSE;
	int cursorX = 480;
	int cursorY = 640;
	int mousesensitivity = 2;

	while (bAlreadySelected == FALSE) {
		int selectedplay = 1;

		int mouseX = GetPlayerInput(-1, INPUT_YAW);
		int mouseY = GetPlayerInput(-1, INPUT_PITCH);
		int buttons = GetPlayerInput(-1, INPUT_BUTTONS);
		
		SetFont("BIGFONT");

		cursorX -= mouseX * mousesensitivity;
		cursorY -= mouseY * mousesensitivity;
		
		if (cursorX < 0) cursorX = 0;
		if (cursorX > 65536) cursorX = 65536;
		if (cursorY < 0) cursorY = 0;
		if (cursorY > 65536) cursorY = 65536;
		
		if (buttons & BT_ATTACK)
		{
			SetPlayerCharacter(selectedplay);
			ACS_NamedExecuteAlways("ClearSelectionMessages",0,0,0,0);
			bAlreadySelected = TRUE;
			
			ready_players+=1;
			if(ready_players >= PlayerCount())
			{
				nightbegin = TRUE;
			}
		}
		
		if (cursorX >= 26214 && cursorX <= 39322)
		{
			if (cursorY >= 16384 && cursorY <= 19661) // Zoey
			{
				HudMessage(s:"ZOEY"; HUDMSG_PLAIN, 5, CR_GREEN, 0.5, 0.25, 0);
				HudMessage(s:"LOUIS"; HUDMSG_PLAIN, 6, CR_GOLD, 0.5, 0.3, 0);
				HudMessage(s:"BILL"; HUDMSG_PLAIN, 7, CR_GOLD, 0.5, 0.35, 0);
				HudMessage(s:"FRANCIS"; HUDMSG_PLAIN, 8, CR_GOLD, 0.5, 0.4, 0);
				HudMessage(s:"NICK"; HUDMSG_PLAIN, 9, CR_GOLD, 0.5, 0.45, 0);
				HudMessage(s:"ELLIS"; HUDMSG_PLAIN, 10, CR_GOLD, 0.5, 0.5, 0);
				SetActorState(ActivatorTID(), "IsZoey", FALSE);
				GiveActorInventory(ActivatorTID(), "IsZoey", 1);
				TakeActorInventory(ActivatorTID(), "IsLouis", 1);
				TakeActorInventory(ActivatorTID(), "IsBill", 1);
				TakeActorInventory(ActivatorTID(), "IsFrancis", 1);
				TakeActorInventory(ActivatorTID(), "IsNick", 1);
				TakeActorInventory(ActivatorTID(), "IsEllis", 1);
				selectedplay = 1;
			}
			else if (cursorY >= 19661 && cursorY <= 22938) // Louis
			{
				HudMessage(s:"ZOEY"; HUDMSG_PLAIN, 5, CR_GOLD, 0.5, 0.25, 0);
				HudMessage(s:"LOUIS"; HUDMSG_PLAIN, 6, CR_GREEN, 0.5, 0.3, 0);
				HudMessage(s:"BILL"; HUDMSG_PLAIN, 7, CR_GOLD, 0.5, 0.35, 0);
				HudMessage(s:"FRANCIS"; HUDMSG_PLAIN, 8, CR_GOLD, 0.5, 0.4, 0);
				HudMessage(s:"NICK"; HUDMSG_PLAIN, 9, CR_GOLD, 0.5, 0.45, 0);
				HudMessage(s:"ELLIS"; HUDMSG_PLAIN, 10, CR_GOLD, 0.5, 0.5, 0);
				SetActorState(ActivatorTID(), "IsLouis", FALSE);
				GiveActorInventory(ActivatorTID(), "IsLouis", 1);
				TakeActorInventory(ActivatorTID(), "IsZoey", 1);
				TakeActorInventory(ActivatorTID(), "IsBill", 1);
				TakeActorInventory(ActivatorTID(), "IsFrancis", 1);
				TakeActorInventory(ActivatorTID(), "IsNick", 1);
				TakeActorInventory(ActivatorTID(), "IsEllis", 1);
				selectedplay = 2;
			}
			else if (cursorY >= 22938 && cursorY <= 26214) // Bill
			{
				HudMessage(s:"ZOEY"; HUDMSG_PLAIN, 5, CR_GOLD, 0.5, 0.25, 0);
				HudMessage(s:"LOUIS"; HUDMSG_PLAIN, 6, CR_GOLD, 0.5, 0.3, 0);
				HudMessage(s:"BILL"; HUDMSG_PLAIN, 7, CR_GREEN, 0.5, 0.35, 0);
				HudMessage(s:"FRANCIS"; HUDMSG_PLAIN, 8, CR_GOLD, 0.5, 0.4, 0);
				HudMessage(s:"NICK"; HUDMSG_PLAIN, 9, CR_GOLD, 0.5, 0.45, 0);
				HudMessage(s:"ELLIS"; HUDMSG_PLAIN, 10, CR_GOLD, 0.5, 0.5, 0);
				SetActorState(ActivatorTID(), "IsBill", FALSE);
				GiveActorInventory(ActivatorTID(), "IsBill", 1);
				TakeActorInventory(ActivatorTID(), "IsLouis", 1);
				TakeActorInventory(ActivatorTID(), "IsZoey", 1);
				TakeActorInventory(ActivatorTID(), "IsFrancis", 1);
				TakeActorInventory(ActivatorTID(), "IsNick", 1);
				TakeActorInventory(ActivatorTID(), "IsEllis", 1);
				selectedplay = 3;
			}
			else if (cursorY >= 26214 && cursorY <= 29491) // Francis
			{
				HudMessage(s:"ZOEY"; HUDMSG_PLAIN, 5, CR_GOLD, 0.5, 0.25, 0);
				HudMessage(s:"LOUIS"; HUDMSG_PLAIN, 6, CR_GOLD, 0.5, 0.3, 0);
				HudMessage(s:"BILL"; HUDMSG_PLAIN, 7, CR_GOLD, 0.5, 0.35, 0);
				HudMessage(s:"FRANCIS"; HUDMSG_PLAIN, 8, CR_GREEN, 0.5, 0.4, 0);
				HudMessage(s:"NICK"; HUDMSG_PLAIN, 9, CR_GOLD, 0.5, 0.45, 0);
				HudMessage(s:"ELLIS"; HUDMSG_PLAIN, 10, CR_GOLD, 0.5, 0.5, 0);
				SetActorState(ActivatorTID(), "IsFrancis", FALSE);
				GiveActorInventory(ActivatorTID(), "IsFrancis", 1);
				TakeActorInventory(ActivatorTID(), "IsLouis", 1);
				TakeActorInventory(ActivatorTID(), "IsBill", 1);
				TakeActorInventory(ActivatorTID(), "IsZoey", 1);
				TakeActorInventory(ActivatorTID(), "IsNick", 1);
				TakeActorInventory(ActivatorTID(), "IsEllis", 1);
				selectedplay = 4;
			}
			else if (cursorY >= 29491 && cursorY <= 32768) // Nick
			{
				HudMessage(s:"ZOEY"; HUDMSG_PLAIN, 5, CR_GOLD, 0.5, 0.25, 0);
				HudMessage(s:"LOUIS"; HUDMSG_PLAIN, 6, CR_GOLD, 0.5, 0.3, 0);
				HudMessage(s:"BILL"; HUDMSG_PLAIN, 7, CR_GOLD, 0.5, 0.35, 0);
				HudMessage(s:"FRANCIS"; HUDMSG_PLAIN, 8, CR_GOLD, 0.5, 0.4, 0);
				HudMessage(s:"NICK"; HUDMSG_PLAIN, 9, CR_GREEN, 0.5, 0.45, 0);
				HudMessage(s:"ELLIS"; HUDMSG_PLAIN, 10, CR_GOLD, 0.5, 0.5, 0);
				SetActorState(ActivatorTID(), "IsNick", FALSE);
				GiveActorInventory(ActivatorTID(), "IsNick", 1);
				TakeActorInventory(ActivatorTID(), "IsLouis", 1);
				TakeActorInventory(ActivatorTID(), "IsBill", 1);
				TakeActorInventory(ActivatorTID(), "IsFrancis", 1);
				TakeActorInventory(ActivatorTID(), "IsZoey", 1);
				TakeActorInventory(ActivatorTID(), "IsEllis", 1);
				selectedplay = 5;
			}
			else if (cursorY >= 32768 && cursorY <= 36046) // Ellis
			{
				HudMessage(s:"ZOEY"; HUDMSG_PLAIN, 5, CR_GOLD, 0.5, 0.25, 0);
				HudMessage(s:"LOUIS"; HUDMSG_PLAIN, 6, CR_GOLD, 0.5, 0.3, 0);
				HudMessage(s:"BILL"; HUDMSG_PLAIN, 7, CR_GOLD, 0.5, 0.35, 0);
				HudMessage(s:"FRANCIS"; HUDMSG_PLAIN, 8, CR_GOLD, 0.5, 0.4, 0);
				HudMessage(s:"NICK"; HUDMSG_PLAIN, 9, CR_GOLD, 0.5, 0.45, 0);
				HudMessage(s:"ELLIS"; HUDMSG_PLAIN, 10, CR_GREEN, 0.5, 0.5, 0);
				SetActorState(ActivatorTID(), "IsEllis", FALSE);
				GiveActorInventory(ActivatorTID(), "IsEllis", 1);
				TakeActorInventory(ActivatorTID(), "IsLouis", 1);
				TakeActorInventory(ActivatorTID(), "IsBill", 1);
				TakeActorInventory(ActivatorTID(), "IsFrancis", 1);
				TakeActorInventory(ActivatorTID(), "IsNick", 1);
				TakeActorInventory(ActivatorTID(), "IsZoey", 1);
				selectedplay = 6;
			}
			else
			{
				HudMessage(s:"ZOEY"; HUDMSG_PLAIN, 5, CR_GOLD, 0.5, 0.25, 0);
				HudMessage(s:"LOUIS"; HUDMSG_PLAIN, 6, CR_GOLD, 0.5, 0.3, 0);
				HudMessage(s:"BILL"; HUDMSG_PLAIN, 7, CR_GOLD, 0.5, 0.35, 0);
				HudMessage(s:"FRANCIS"; HUDMSG_PLAIN, 8, CR_GOLD, 0.5, 0.4, 0);
				HudMessage(s:"NICK"; HUDMSG_PLAIN, 9, CR_GOLD, 0.5, 0.45, 0);
				HudMessage(s:"ELLIS"; HUDMSG_PLAIN, 10, CR_GOLD, 0.5, 0.5, 0);
				SetActorState(ActivatorTID(), "IsZoey", FALSE);
				GiveActorInventory(ActivatorTID(), "IsZoey", 1);
				TakeActorInventory(ActivatorTID(), "IsLouis", 1);
				TakeActorInventory(ActivatorTID(), "IsBill", 1);
				TakeActorInventory(ActivatorTID(), "IsFrancis", 1);
				TakeActorInventory(ActivatorTID(), "IsNick", 1);
				TakeActorInventory(ActivatorTID(), "IsEllis", 1);
				selectedplay = 1;
			}
		}
		else
		{
			HudMessage(s:"ZOEY"; HUDMSG_PLAIN, 5, CR_GOLD, 0.5, 0.25, 0);
			HudMessage(s:"LOUIS"; HUDMSG_PLAIN, 6, CR_GOLD, 0.5, 0.3, 0);
			HudMessage(s:"BILL"; HUDMSG_PLAIN, 7, CR_GOLD, 0.5, 0.35, 0);
			HudMessage(s:"FRANCIS"; HUDMSG_PLAIN, 8, CR_GOLD, 0.5, 0.4, 0);
			HudMessage(s:"NICK"; HUDMSG_PLAIN, 9, CR_GOLD, 0.5, 0.45, 0);
			HudMessage(s:"ELLIS"; HUDMSG_PLAIN, 10, CR_GOLD, 0.5, 0.5, 0);
			SetActorState(ActivatorTID(), "IsZoey", FALSE);
			GiveActorInventory(ActivatorTID(), "IsZoey", 1);
			TakeActorInventory(ActivatorTID(), "IsLouis", 1);
			TakeActorInventory(ActivatorTID(), "IsBill", 1);
			TakeActorInventory(ActivatorTID(), "IsFrancis", 1);
			TakeActorInventory(ActivatorTID(), "IsNick", 1);
			TakeActorInventory(ActivatorTID(), "IsEllis", 1);
			selectedplay = 1;
		}
		
		SetFont("MENUCURS");
		HudMessage(s:"A"; HUDMSG_PLAIN, 111, CR_RED, cursorX, cursorY, 0);
		delay(1);
	}
}

script "TeleportPlayersToSpawn" (void)
{
	SetPlayerProperty(1, 0, PROP_TOTALLYFROZEN);
	TeleportOther(1000, 500, 0);
	TeleportOther(1001, 501, 0);
	TeleportOther(1002, 502, 0);
	TeleportOther(1003, 503, 0);
	TeleportOther(1004, 504, 0);
	TeleportOther(1005, 505, 0);
	TeleportOther(1006, 506, 0);
	TeleportOther(1007, 507, 0);
}